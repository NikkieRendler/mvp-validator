<app-header></app-header>
<div nz-row class="project-management-wrapper">
    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="3" nzXl="3" class="secondary-navigation">
        <div class="secondary-navigation-item-wrapper" (click)="showProjectPreview(composedProject)">
            <div fxLayout="column" fxLayoutAlign="center center"
                [ngStyle]="{'border-color': composedProject.theme, 'color': composedProject.theme}"
                class="secondary-navigation-item">
                <span><b>{{composedProject.name}}</b></span>
            </div>
            <button nz-button nzType="link" (click)="showProjectPreview(composedProject)">Live link</button>
        </div>
    </div>
    <div nz-col nzXs="0" nzSm="0" nzMd="0" nzLg="2" nzXl="2" style="height: 70vh; text-align: center;">
        <nz-divider nzType="vertical" style="height: 100%; background-color: rgba(0, 0, 0, 0.3);"></nz-divider>
    </div>
    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="11" nzXl="11">
        <nz-descriptions [nzTitle]="projectInfoHeader" nzBordered
            [nzColumn]="{ xxl: 1, xl: 1, lg: 1, md: 1, sm: 1, xs: 1 }">
            <ng-template #projectInfoHeader>
                <div style="display: flex; align-items: center;">
                    <div>Project info</div>
                </div>
            </ng-template>
            <nz-descriptions-item nzTitle="Name">
                {{composedProject.name}}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Color theme">
                <span nz-text nzEditable [(nzContent)]="composedProject.theme" (nzContentChange)="editProject()"></span>
                <input [formControl]="colorControl" style="height: 0; width: 0; visibility: hidden;" #colorPickerInput
                    [(colorPicker)]="composedProject.theme" (colorPickerChange)="changeColor($event)"
                    [cpPosition]="'bottom'" [cpOutputFormat]="'hsla'" />
                <i style="cursor: pointer; margin-left: 10px; color: #1890ff" (click)="colorPickerInput.click()" nz-icon
                    nzType="bg-colors" nzTheme="outline"></i>
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Title">
                <span nz-text nzEditable (nzContentChange)="editProject()" [(nzContent)]="composedProject.title"></span>
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Description">
                <span nz-text nzEditable (nzContentChange)="editProject()"
                    [(nzContent)]="composedProject.description"></span>
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Features">
                <div *ngFor="let feature of composedProject.features; let i = index;">
                    <span nz-text nzEditable (nzContentChange)="assignNewFeature(i, $event)"
                        [(nzContent)]="composedProject.features[i]"></span>
                    <br>
                </div>
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Engagement">
                <div nz-row nzType="flex" nzJustify="space-between" nzAlign="middle">
                    <div>
                        <b>{{composedProject.engagedUsers.length}}</b> users submitted
                    </div>
                    <div>
                        <button (click)="showEngagementList()" [disabled]="composedProject.engagedUsers.length === 0"
                            nz-button nzShape="circle" nzType="link">
                            <i nz-icon nzType="right-circle" nzTheme="outline"></i>
                        </button>
                    </div>
                </div>
            </nz-descriptions-item>
        </nz-descriptions>
        <div style="display: flex; justify-content: flex-start; padding: 10px 0;">
            <button (click)="toggleDeleteModal()" class="delete-button" nz-button nzType="link">Delete project</button>
        </div>
        <nz-modal [(nzVisible)]="modalView" [nzTitle]="null" [nzFooter]="deleteFooter"
            (nzOnCancel)="handleCancel()">
                <div style="text-align: center">
                    Are you sure you want to delete this project? <br> 
                    This cannot be undone
                </div>
                <ng-template #deleteFooter>
                    <button nz-button nzType="default" (click)="handleCancel()">Cancel</button>
                    <button nz-button nzType="danger" (click)="deleteProject(composedProject._id)">Delete</button>
                </ng-template>
        </nz-modal>
    </div>
    <div nz-col nzXs="0" nzSm="0" nzMd="0" nzLg="1" nzXl="1"></div>
    <div *ngIf="isEngagementListVisible" class="engagement-list" nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="7" nzXl="7">
        <nz-descriptions nzTitle="Engagement list" nzSize="small" nzBordered
            [nzColumn]="{ xxl: 1, xl: 1, lg: 1, md: 1, sm: 1, xs: 1 }">
            <nz-descriptions-item *ngFor="let user of composedProject.engagedUsers" nzTitle="{{user.email}}">
                {{user.name}}
                <br>
                {{user.text ? user.text : '...'}}
            </nz-descriptions-item>
        </nz-descriptions>
    </div>
</div>


<div nz-row>
    <div nz-row class="preview-bottom-actions-wrapper">
        <div nz-col nzSpan="8" style="display: flex; justify-content: center;">
            <button *ngIf="isUserLogged" [routerLink]="['/dashboard']" nz-button>
                <i nz-icon nzType="arrow-left" nzTheme="outline"></i> Dashboard
            </button>
        </div>
        <div nz-col nzSpan="8"></div>
        <div nz-col nzSpan="8"></div>
    </div>
</div>